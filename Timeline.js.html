<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Timeline.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="EventClass.html">EventClass</a><ul class='methods'><li data-type='method'><a href="EventClass.html#emit">emit</a></li><li data-type='method'><a href="EventClass.html#off">off</a></li><li data-type='method'><a href="EventClass.html#on">on</a></li><li data-type='method'><a href="EventClass.html#once">once</a></li></ul></li><li><a href="Lite.html">Lite</a><ul class='methods'><li data-type='method'><a href="Lite.html#delay">delay</a></li><li data-type='method'><a href="Lite.html#duration">duration</a></li><li data-type='method'><a href="Lite.html#easing">easing</a></li><li data-type='method'><a href="Lite.html#interpolation">interpolation</a></li><li data-type='method'><a href="Lite.html#isPlaying">isPlaying</a></li><li data-type='method'><a href="Lite.html#isStarted">isStarted</a></li><li data-type='method'><a href="Lite.html#onComplete">onComplete</a></li><li data-type='method'><a href="Lite.html#onStart">onStart</a></li><li data-type='method'><a href="Lite.html#onUpdate">onUpdate</a></li><li data-type='method'><a href="Lite.html#pause">pause</a></li><li data-type='method'><a href="Lite.html#play">play</a></li><li data-type='method'><a href="Lite.html#repeat">repeat</a></li><li data-type='method'><a href="Lite.html#repeatDelay">repeatDelay</a></li><li data-type='method'><a href="Lite.html#reverseDelay">reverseDelay</a></li><li data-type='method'><a href="Lite.html#start">start</a></li><li data-type='method'><a href="Lite.html#stop">stop</a></li><li data-type='method'><a href="Lite.html#to">to</a></li><li data-type='method'><a href="Lite.html#update">update</a></li><li data-type='method'><a href="Lite.html#yoyo">yoyo</a></li></ul></li><li><a href="Timeline.html">Timeline</a><ul class='methods'><li data-type='method'><a href="Timeline.html#add">add</a></li><li data-type='method'><a href="Timeline.html#addLabel">addLabel</a></li><li data-type='method'><a href="Timeline.html#from">from</a></li><li data-type='method'><a href="Timeline.html#fromTo">fromTo</a></li><li data-type='method'><a href="Timeline.html#to">to</a></li></ul></li><li><a href="Tween.html">Tween</a><ul class='methods'><li data-type='method'><a href="Tween.html#.from">from</a></li><li data-type='method'><a href="Tween.html#.fromTo">fromTo</a></li><li data-type='method'><a href="Tween.html#.to">to</a></li><li data-type='method'><a href="Tween.html#delay">delay</a></li><li data-type='method'><a href="Tween.html#duration">duration</a></li><li data-type='method'><a href="Tween.html#easing">easing</a></li><li data-type='method'><a href="Tween.html#isPlaying">isPlaying</a></li><li data-type='method'><a href="Tween.html#isStarted">isStarted</a></li><li data-type='method'><a href="Tween.html#pause">pause</a></li><li data-type='method'><a href="Tween.html#play">play</a></li><li data-type='method'><a href="Tween.html#reassignValues">reassignValues</a></li><li data-type='method'><a href="Tween.html#render">render</a></li><li data-type='method'><a href="Tween.html#repeat">repeat</a></li><li data-type='method'><a href="Tween.html#repeatDelay">repeatDelay</a></li><li data-type='method'><a href="Tween.html#restart">restart</a></li><li data-type='method'><a href="Tween.html#reverse">reverse</a></li><li data-type='method'><a href="Tween.html#reversed">reversed</a></li><li data-type='method'><a href="Tween.html#reverseDelay">reverseDelay</a></li><li data-type='method'><a href="Tween.html#seek">seek</a></li><li data-type='method'><a href="Tween.html#start">start</a></li><li data-type='method'><a href="Tween.html#stop">stop</a></li><li data-type='method'><a href="Tween.html#to">to</a></li><li data-type='method'><a href="Tween.html#update">update</a></li><li data-type='method'><a href="Tween.html#yoyo">yoyo</a></li></ul></li><li><a href="TWEEN_.html">TWEEN</a><ul class='methods'><li data-type='method'><a href="TWEEN_.html#.add">add</a></li><li data-type='method'><a href="TWEEN_.html#.autoPlay">autoPlay</a></li><li data-type='method'><a href="TWEEN_.html#.get">get</a></li><li data-type='method'><a href="TWEEN_.html#.has">has</a></li><li data-type='method'><a href="TWEEN_.html#.isRunning">isRunning</a></li><li data-type='method'><a href="TWEEN_.html#.onTick">onTick</a></li><li data-type='method'><a href="TWEEN_.html#.remove">remove</a></li><li data-type='method'><a href="TWEEN_.html#.removeAll">removeAll</a></li><li data-type='method'><a href="TWEEN_.html#.update">update</a></li></ul></li><li><a href="TWEEN.Easing.html">Easing</a></li><li><a href="TWEEN.Interpolation.html">Interpolation</a></li><li><a href="TWEEN.Plugins.html">Plugins</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-Basics.html">Basics</a></li><li><a href="tutorial-Compatibility.html">Compatibility</a></li><li><a href="tutorial-Simple Demos.html">Simple Demos</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">Timeline.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { add, now, remove } from './core'
import PlaybackPosition from './PlaybackPosition'
import Tween, { EVENT_COMPLETE, EVENT_REPEAT, EVENT_REVERSE, EVENT_RS, EVENT_UPDATE } from './Tween'
export const shuffle = (a) => {
  let j
  let x
  let i
  for (i = a.length; i; i -= 1) {
    j = Math.floor(Math.random() * i)
    x = a[i - 1]
    a[i - 1] = a[j]
    a[j] = x
  }
  return a
}
let _id = 0
/**
 * Timeline main constructor.
 *
 * It works same as `Tween` instance, using `.repeat`, `.restart` or `etc` works like a `Tween`, so please see `Tween` class for methods
 * @constructor
 * @class
 * @namespace Timeline
 * @param {Object=} params Default params for new tweens
 * @example let tl = new Timeline({delay:200})
 * @extends Tween
 */
class Timeline extends Tween {
  constructor (params) {
    super()
    this._duration = 0
    this._startTime = now()
    this._tweens = []
    this._elapsed = 0
    this._id = _id++
    this._defaultParams = params
    this.position = new PlaybackPosition()
    this.position.addLabel('afterLast', this._duration)
    this.position.addLabel('afterInit', this._startTime)
    return this
  }
  mapTotal (fn) {
    fn.call(this, this._tweens)
    return this
  }
  timingOrder (fn) {
    const timing = fn(this._tweens.map((t) => t._startTime))
    this._tweens.map((tween, i) => { tween._startTime = timing[i] })
    return this
  }
  getTiming (mode, nodes, params, offset = 0) {
    if (mode === 'reverse') {
      const { stagger } = params
      const totalStagger = (stagger || 0) * (nodes.length - 1)
      return nodes.map((node, i) => totalStagger - ((stagger || 0) * i) + offset)
    } else if (mode === 'async') {
      return nodes.map((node) => offset)
    } else if (mode === 'sequence' || mode === 'delayed') {
      let { stagger } = params
      if (!stagger) {
        stagger = (params.duration || 1000) / (nodes.length - 1)
      }
      return nodes.map((node, i) => (stagger * i) + offset)
    } else if (mode === 'oneByOne') {
      return nodes.map((node) => params.duration)
    } else if (mode === 'shuffle') {
      const { stagger } = params
      return shuffle(nodes.map((node, i) => ((stagger || 0) * i) + offset))
    } else {
      const { stagger } = params
      return nodes.map((node, i) => ((stagger || 0) * i) + offset)
    }
  }
  /**
     * @param {Array&lt;Element>} nodes DOM Elements Collection (converted to Array)
     * @param {object} from - Initial value
     * @param {object} to - Target value
     * @param {object} params - Options of tweens
     * @example tl.fromTo(nodes, {x:0}, {x:200}, {duration:1000, stagger:200})
     * @memberof Timeline
     * @static
     */
  fromTo (nodes, from, to, params) {
    if (Array.isArray(nodes)) {
      if (this._defaultParams) {
        params = Object.assign({}, this._defaultParams, params)
      }
      const position = params.label
      const offset = typeof position === 'number' ? position : this.position.parseLabel(typeof position !== 'undefined' ? position : 'afterLast', null)
      const mode = this.getTiming(params.mode, nodes, params, offset)
      nodes.map((node, i) => {
        this.add(Tween.fromTo(node, typeof from === 'function' ? from(i, nodes.length) : Object.assign({}, from), typeof to === 'function' ? to(i, nodes.length) : to, typeof params === 'function' ? params(i, nodes.length) : params), mode[i])
      })
    }
    return this.start()
  }
  /**
     * @param {Array&lt;Element>} nodes DOM Elements Collection (converted to Array)
     * @param {object} from - Initial value
     * @param {object} params - Options of tweens
     * @example tl.from(nodes, {x:200}, {duration:1000, stagger:200})
     * @memberof Timeline
     * @static
     */
  from (nodes, from, params) {
    return this.fromTo(nodes, from, null, params)
  }
  /**
     * @param {Array&lt;Element>} nodes DOM Elements Collection (converted to Array)
     * @param {object} to - Target value
     * @param {object} params - Options of tweens
     * @example tl.to(nodes, {x:200}, {duration:1000, stagger:200})
     * @memberof Timeline
     * @static
     */
  to (nodes, to, params) {
    return this.fromTo(nodes, null, to, params)
  }
  /**
     * Add label to Timeline
     * @param {string} name Label name
     * @param {any} offset Label value, can be `number` and/or `string`
     * @example tl.add('label1', 200)
     * @memberof Timeline
     */
  addLabel (name, offset) {
    this.position.addLabel(name, offset)
    return this
  }
  map (fn) {
    for (let i = 0, len = this._tweens.length; i &lt; len; i++) {
      const _tween = this._tweens[i]
      fn(_tween, i)
      this._duration = Math.max(this._duration, _tween._duration + _tween._startTime)
    }
    return this
  }
  /**
     * Add tween to Timeline
     * @param {Tween} tween Tween instance
     * @param {position} position Can be label name, number or relative number to label
     * @example tl.add(new Tween(node, {x:0}).to({x:200}, 200))
     * @memberof Timeline
     */
  add (tween, position) {
    if (Array.isArray(tween)) {
      tween.map((_tween) => {
        this.add(_tween, position)
      })
      return this
    } else if (typeof tween === 'object' &amp;&amp; !(tween instanceof Tween)) {
      tween = new Tween(tween.from).to(tween.to, tween)
    }
    const { _defaultParams, _duration } = this
    if (_defaultParams) {
      for (const method in _defaultParams) {
        if (typeof tween[method] === 'function') {
          tween[method](_defaultParams[method])
        }
      }
    }
    const offset = typeof position === 'number' ? position : this.position.parseLabel(typeof position !== 'undefined' ? position : 'afterLast', null)
    tween._startTime = Math.max(this._startTime, tween._delayTime)
    tween._startTime += offset
    tween._isPlaying = true
    this._duration = Math.max(_duration, tween._startTime + tween._delayTime + tween._duration)
    this._tweens.push(tween)
    this.position.setLabel('afterLast', this._duration)
    return this
  }
  restart () {
    this._startTime += now()
    add(this)
    return this.emit(EVENT_RS)
  }
  easing (easing) {
    return this.map((tween) => tween.easing(easing))
  }
  interpolation (interpolation) {
    return this.map((tween) => tween.interpolation(interpolation))
  }
  update (time) {
    const { _tweens, _duration, _repeatDelayTime, _reverseDelayTime, _startTime, _reversed, _yoyo, _repeat, _isFinite, _elapsed, _isPlaying } = this
    if (!_isPlaying || time &lt; _startTime) {
      return true
    }
    let elapsed = (time - _startTime) / _duration
    elapsed = elapsed > 1 ? 1 : elapsed
    elapsed = _reversed ? 1 - elapsed : elapsed
    elapsed = ((elapsed * 1000) | 0) / 1000
    if (elapsed === _elapsed) {
      return true
    }
    this._elapsed = elapsed
    const timing = time - _startTime
    const _timing = _reversed ? _duration - timing : timing
    let i = 0
    while (i &lt; _tweens.length) {
      _tweens[i].update(_timing, true)
      i++
    }
    this.emit(EVENT_UPDATE, elapsed, timing)
    if (elapsed === 1 || (_reversed &amp;&amp; elapsed === 0)) {
      if (_repeat) {
        if (_isFinite) {
          this._repeat--
        }
        this.emit(_reversed ? EVENT_REVERSE : EVENT_REPEAT)
        if (_yoyo) {
          this._reversed = !_reversed
          this.timingOrder((timing) => timing.reverse())
        }
        if (!_reversed &amp;&amp; _repeatDelayTime) {
          this._startTime = time + _repeatDelayTime
        } else if (_reversed &amp;&amp; _reverseDelayTime) {
          this._startTime = time + _reverseDelayTime
        } else {
          this._startTime = time
        }
        while (i &lt; _tweens.length) {
          _tweens[i].reassignValues()
          i++
        }
        return true
      } else {
        this.emit(EVENT_COMPLETE)
        this._repeat = this._r
        remove(this)
        this._isPlaying = false
        return false
      }
    }
    return true
  }
  elapsed (value) {
    return value !== undefined ? this.update(value * this._duration) : this._elapsed
  }
}
export default Timeline
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Sep 18 2017 22:40:40 GMT+0500 (Западная Азия (зима)) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
